BootStrap: docker
From: pytorch/pytorch:2.3.1-cuda11.8-cudnn8-devel
# From: nvidia/cuda:11.8.0-devel-ubuntu22.04

%files
    ./.singularity/modules /opt/

%setup
    cp -r ./.singularity/modules ${SINGULARITY_ROOTFS}/opt/
    source ${SINGULARITY_ROOTFS}/opt/modules/setup/mk-bind-dirs.sh

%post
    # Python
    source ${SINGULARITY_ROOTFS}/opt/modules/post/python/apt-python3.sh
    source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-01-basic.sh
    source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-02-dev.sh
    source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-03-image.sh
    source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-04-video.sh
    source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-05-dsp.sh
    source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-06-ml.sh
    source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-06-stats.sh
    # source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-07-torch-cuda-10.2.sh
    # source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-07-torch-cuda-11.8.sh
    # source ${SINGULARITY_ROOTFS}/opt/modules/post/python/pip-07-torch-cuda-12.1.sh


%environment
    # Pipenv requires a certain terminal encoding.
    export LANG=C.UTF-8
    export LC_ALL=C.UTF-8
    # This configures Pipenv to store the packages in the current working
    # directory.
    export PIPENV_VENV_IN_PROJECT=1